---
import "../styles/global.css";

interface Props {
	title: string;
	description?: string;
}

const { title, description = "Developer Portfolio" } = Astro.props;
---

<!doctype html>
<html lang="en" class="scroll-smooth" data-theme="light">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="generator" content={Astro.generator} />
		<meta name="description" content={description} />
		<title>{title}</title>
	</head>
	<body
		class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200"
	>
		<header
			class="sticky top-0 z-50 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800"
		>
			<nav class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="flex items-center justify-between h-16">
					<a
						href="/"
						class="text-xl font-bold text-gray-900 dark:text-white hover:text-gray-700 dark:hover:text-gray-300 transition-colors"
					>
						Portfolio
					</a>
					<div class="flex items-center gap-6">
						<a
							href="/"
							class="text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors"
						>
							Home
						</a>
						<a
							href="/about"
							class="text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors"
						>
							About
						</a>
						<a
							href="/cv"
							class="text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors"
						>
							CV
						</a>
						<button
							id="theme-toggle"
							class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
							aria-label="Toggle dark mode"
						>
							<svg
								id="sun-icon"
								class="w-5 h-5 text-gray-900 dark:hidden"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
								></path>
							</svg>
							<svg
								id="moon-icon"
								class="w-5 h-5 text-gray-100 hidden dark:block"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
								></path>
							</svg>
						</button>
					</div>
				</div>
			</nav>
		</header>

		<main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
			<slot />
		</main>

		<footer class="border-t border-gray-200 dark:border-gray-800 mt-16">
			<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
				<div
					class="flex flex-col sm:flex-row items-center justify-between gap-4"
				>
					<p class="text-sm text-gray-600 dark:text-gray-400">
						Â© {new Date().getFullYear()} Portfolio. All rights reserved.
					</p>
					<div class="flex gap-4">
						<a
							href="https://github.com/drFabio"
							target="_blank"
							rel="noopener noreferrer"
							class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
						>
							GitHub
						</a>
						<a
							href="https://www.linkedin.com/in/fabiothedev"
							target="_blank"
							rel="noopener noreferrer"
							class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
						>
							LinkedIn
						</a>
					</div>
				</div>
			</div>
		</footer>

		<script is:inline>
			// Apply theme immediately to prevent flash of wrong theme
			(function () {
				try {
					const stored = localStorage.getItem("theme");
					const prefersDark = window.matchMedia(
						"(prefers-color-scheme: dark)",
					).matches;
					const shouldBeDark =
						stored === "dark" || (!stored && prefersDark);

					if (shouldBeDark) {
						document.documentElement.classList.add("dark");
					} else {
						document.documentElement.classList.remove("dark");
					}
				} catch (e) {
					// Fallback if localStorage is not available
					console.warn("Could not set initial theme:", e);
				}
			})();
		</script>
		<script>
			// Theme toggle functionality
			document.addEventListener("DOMContentLoaded", function () {
				const themeToggle = document.getElementById("theme-toggle");
				const html = document.documentElement;
				const sunIcon = document.getElementById("sun-icon");
				const moonIcon = document.getElementById("moon-icon");

				if (!themeToggle) {
					console.warn("Theme toggle button not found");
					return;
				}

				// Update icon visibility
				function updateIcons() {
					const isDark = html.classList.contains("dark");
					if (sunIcon) {
						sunIcon.classList.toggle("hidden", isDark);
					}
					if (moonIcon) {
						moonIcon.classList.toggle("hidden", !isDark);
					}
				}

				// Apply theme
				function setTheme(theme) {
					if (theme === "dark") {
						html.classList.add("dark");
					} else {
						html.classList.remove("dark");
					}
					try {
						localStorage.setItem("theme", theme);
					} catch (e) {
						console.warn(
							"Could not save theme to localStorage:",
							e,
						);
					}
					updateIcons();
				}

				// Initialize icons based on current theme
				updateIcons();

				// Toggle theme on button click
				themeToggle.addEventListener("click", function () {
					const currentTheme = html.classList.contains("dark")
						? "dark"
						: "light";
					setTheme(currentTheme === "dark" ? "light" : "dark");
				});
			});
		</script>
	</body>
</html>
